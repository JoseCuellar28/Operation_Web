<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>UI Test Suite</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: "#1e3a8a", foreground: "#ffffff" },
                        secondary: { DEFAULT: "#f1f5f9", foreground: "#0f172a" },
                        destructive: { DEFAULT: "#ef4444", foreground: "#ffffff" },
                        muted: { DEFAULT: "#f8fafc", foreground: "#64748b" },
                        accent: { DEFAULT: "#3b82f6", foreground: "#ffffff" },
                    }
                }
            }
        }
    </script>
    <!-- DOMPurify -->
    <script src="js/vendor/purify.min.js"></script>
    <!-- UI Components -->
    <script src="js/ui-components.js?v=test"></script>
</head>

<body>
    <div id="test-output" style="font-family: monospace; padding: 20px;">Running Tests...</div>
    <div id="render-target" style="display:none;"></div>

    <script>
        const output = document.getElementById('test-output');
        const renderTarget = document.getElementById('render-target');
        let results = [];
        let passed = 0;
        let failed = 0;

        function assert(desc, condition) {
            const status = condition ? "PASS" : "FAIL";
            if (condition) passed++; else failed++;
            results.push(`[${status}] ${desc}`);
        }

        function runTests() {
            // Group 1: Environment
            assert("UIComponents object exists", typeof UIComponents !== 'undefined');
            assert("getConfiguracionContent function exists", typeof UIComponents.getConfiguracionContent === 'function');

            // Group 2: Content Generation
            const content = UIComponents.getConfiguracionContent();
            assert("Content is a string", typeof content === 'string');
            assert("Content is not empty", content.length > 0);

            // Group 3: Tailwind Classes Presence
            assert("Contains 'max-w-4xl'", content.includes('max-w-4xl'));
            assert("Contains 'text-primary'", content.includes('text-primary'));
            assert("Contains 'bg-card'", content.includes('bg-card'));
            assert("Contains 'shadow-sm'", content.includes('shadow-sm'));
            assert("Contains 'rounded-lg'", content.includes('rounded-lg'));

            // Group 4: Form Elements
            assert("Contains form tag", content.includes('<form'));
            assert("Contains input tags", content.includes('<input'));
            assert("Contains button tags", content.includes('<button'));

            // Group 5: Attributes
            assert("Contains placeholder", content.includes('placeholder="smtp.gmail.com"'));
            assert("Contains type=password", content.includes('type="password"'));
            assert("Contains onsubmit", content.includes('onsubmit="event.preventDefault(); guardarConfiguracion();"'));

            // Group 6: DOMPurify Integration
            const config = { ADD_TAGS: ['style'], ADD_ATTR: ['onclick', 'onchange', 'onsubmit', 'class', 'id', 'style', 'target', 'placeholder', 'type', 'value', 'name'] };
            const sanitized = DOMPurify.sanitize(content, config);

            assert("Sanitized content is not empty", sanitized.length > 0);
            assert("Sanitized content preserves classes", sanitized.includes('class="max-w-4xl'));
            assert("Sanitized content preserves onsubmit", sanitized.includes('onsubmit="event.preventDefault(); guardarConfiguracion();"'));
            assert("Sanitized content preserves inputs", sanitized.includes('<input'));

            // Group 7: Rendering
            renderTarget.innerHTML = sanitized;
            const renderedInput = renderTarget.querySelector('#smtp-host');
            assert("Rendered input exists", !!renderedInput);
            assert("Rendered input has correct class", renderedInput && renderedInput.classList.contains('bg-background'));

            // Output Results
            output.innerHTML = `
                <h2>Test Results: ${passed}/${passed + failed} Passed</h2>
                <ul>${results.map(r => `<li style="color:${r.startsWith('[PASS]') ? 'green' : 'red'}">${r}</li>`).join('')}</ul>
            `;
        }

        // Run after load
        window.onload = runTests;
    </script>
</body>

</html>