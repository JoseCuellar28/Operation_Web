<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Modern Dashboard Functionality Test</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="../frontend/Modelo_Funcional/js/vendor/purify.min.js"></script>
    <script src="../frontend/Modelo_Funcional/js/ui-components.js?v=test_func"></script>

    <!-- Mock API Environment -->
    <script>
        // Mock localStorage
        localStorage.setItem('api_net', 'http://mock-api-net');
        localStorage.setItem('api_fase4', 'http://mock-api-fase4');

        // Mock Fetch
        const originalFetch = window.fetch;
        window.fetch = async (url, options) => {
            console.log(`[TEST] Fetching: ${url}`);
            if (url.includes('api/personal')) {
                return {
                    ok: true,
                    json: async () => ([
                        { dni: 'TEST001', inspector: 'JUAN PEREZ (API)', estado: 'Activo', tipo: 'CHOFER' },
                        { dni: 'TEST002', inspector: 'MARIA LOPEZ (API)', estado: 'Inactivo', tipo: 'INSPECTOR' }
                    ])
                };
            }
            return originalFetch(url, options);
        };
    </script>

    <!-- Load Dashboard Logic -->
    <script src="../frontend/Modelo_Funcional/js/dashboard_moderno.js?v=test_func"></script>
</head>

<body>
    <div id="test-output" style="font-family: monospace; padding: 20px;">Running Functionality Tests...</div>

    <!-- Dashboard Structure (Simplified) -->
    <div id="main-content"></div>
    <div id="sidebar-nav"></div>
    <div id="page-title"></div>

    <script>
        const output = document.getElementById('test-output');
        let results = [];
        let passed = 0;
        let failed = 0;

        function assert(desc, condition) {
            const status = condition ? "PASS" : "FAIL";
            if (condition) passed++; else failed++;
            results.push(`[${status}] ${desc}`);
        }

        async function runTests() {
            // Wait for Dashboard to Init
            await new Promise(r => setTimeout(r, 500));

            // Test 1: Dashboard Instance
            assert("Dashboard instance created", window.dashboard instanceof ModernDashboard);

            // Test 2: Load Page Triggered
            const title = document.getElementById('page-title').textContent;
            assert("Page title updated", title === 'Crea tus Colaboradores');

            // Test 3: Content Rendering
            const tbody = document.getElementById('colaboradores-tbody');
            assert("Table body exists", !!tbody);

            // Wait for "API" Load
            await new Promise(r => setTimeout(r, 1000));

            // Test 4: Data Loading
            const rows = tbody.querySelectorAll('tr');
            assert("Rows rendered from API", rows.length >= 2);
            if (rows.length > 0) {
                assert("Row content correct", rows[0].textContent.includes('JUAN PEREZ (API)'));
            }

            // Output Results
            output.innerHTML = `
                <h2>Functionality Test Results: ${passed}/${passed + failed} Passed</h2>
                <ul>${results.map(r => `<li style="color:${r.startsWith('[PASS]') ? 'green' : 'red'}">${r}</li>`).join('')}</ul>
            `;
        }

        window.onload = runTests;
    </script>
</body>

</html>